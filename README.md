# Финальный проект по курсу "Вычисления на GPU"

В этом проекте я реализую вычисление на GPU [фильтра Собеля](https://ru.wikipedia.org/wiki/%D0%9E%D0%BF%D0%B5%D1%80%D0%B0%D1%82%D0%BE%D1%80_%D0%A1%D0%BE%D0%B1%D0%B5%D0%BB%D1%8F), который широко используется в компьютерном зрении для выделения краев на изображении.

Клиент частично переиспользован из аналогичного проекта однокурсников, которые защитили свой проект на лекции раньше. Он кодирует изображение в байты и отправляет его на удаленный сервер. При этом может быть использовано несколько серверов, в этом случае входные изображения равномерно распределяются по доступным серверам и каждый сервер обрабатывает только свою часть изображений. Отправка запросов серверам осуществляется ассинхронно через aiohttp.

Сервер принимает на вход изображение в байтах, преобразует его в массив, создает массив в три раза меньшего размера (с одним каналом) для результата и загружает эти массивы на GPU. При этом используется глобальная память. В каждом треде на GPU обрабатывается несколько пикселей, итерация происходит последовательно по оси иксов. Для каждого пикселя применяются операции свертки со специальными ядрами для вычисления приблизительного градиента по оси x и y, а затем берется их норма и сравнивается с порогом, в случае если она больше порога, то пиксель будет белый в результирующем изображении, иначе - черный. При этом вычисления проводятся по трем каналам, а затем усредняются с весами для перехода в grayscale пространство. Это вероятно будет не оптимально для большого объема данных, поскольку мы несколько раз вычисляем grayscale представление для каждого пикселя, однако если мы хотим сперва получить grayscale представление, а потом применять непосредственно фильтр Собеля, нам вероятно придется писать два последовательных ядра на GPU, что неоптимально для не очень большого объема данных, ведь на инициализацию тоже тратится время. Далее получив результат, сервер кодирует его обратно в байты и передает клиенту, который затем расшифровывает его и записывает в директорию с результатами.

Замер времени на операцию осуществляется с помощью cuda.Event() на GPU и asyncio для всего кода. По результатам замера получилось 3412.18 ms на 4 изображения на GPU и 4.2125 секунд общее время, то есть на передачу данных тратится значительно больше времени, чем на вычисления на GPU, что ожидаемо.

Примеры исходных изображений можно найти в папке images, результатов применения фильтра Собеля - в папке results.
